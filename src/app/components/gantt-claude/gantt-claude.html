<div class="gantt-container">
  <div class="gantt-header">
    <div class="task-names-header">
      <div class="task-name">Задачи</div>
    </div>
    <div class="timeline-header" #timelineHeader (scroll)="onTimelineScroll($event)">
      <!-- *ngFor="let unit of timeline" -->
      @for(unit of timeline; track $index) {
      <div
        class="timeline-unit"
        [class.weekend]="unit.isWeekend"
        [style.min-width.px]="dayWidth"
        [style.width.px]="dayWidth"
      >
        {{ unit.label }}
      </div>
      }
    </div>
  </div>

  <div class="gantt-body">
    <div class="tasks-section">
      <!-- *ngFor="let task of tasks; trackBy: trackByTaskId" -->
      @for (task of tasks; track task.id) {
      <div class="task-row" [style.height.px]="rowHeight">
        <div class="task-name">{{ task.name }}</div>
      </div>
      }
    </div>

    <div class="chart-section" #chartSection (scroll)="onTimelineScroll($event)">
      <!-- Сетка временной шкалы -->
      <div class="timeline-grid">
        <!-- *ngFor="let unit of timeline" -->
        @for (unit of timeline; track $index) {
        <div class="grid-line" [class.weekend]="unit.isWeekend" [style.width.px]="dayWidth"></div>
        }
      </div>

      <!-- Полосы задач -->
      <div class="tasks-bars">
        <!-- *ngFor="let task of tasks; let i = index; trackBy: trackByTaskId" -->
        @for (task of tasks; let i = $index; track task.id;) {
        <div
          class="task-bar-container"
          [style.height.px]="rowHeight"
          [style.top.px]="i * rowHeight"
        >
          <div
            class="task-bar"
            [style.left.px]="getTaskLeft(task)"
            [style.width.px]="getTaskWidth(task)"
            [style.background-color]="task.color || '#4CAF50'"
          >
            <div class="task-progress" [style.width.%]="task.progress"></div>

            <span class="task-bar-label">{{ task.progress }}%</span>
          </div>
        </div>
        }
      </div>

      <!-- SVG для соединительных линий -->
      <svg class="dependencies-svg" [attr.width]="chartWidth" [attr.height]="chartHeight">
        <defs>
          <linearGradient id="line-gradient-template" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" stop-color="var(--start-color)" />
            <stop offset="100%" stop-color="var(--end-color)" />
          </linearGradient>
          <marker
            id="arrowhead"
            viewBox="0 0 10 10"
            refX="8"
            refY="5"
            markerWidth="6"
            markerHeight="6"
            orient="auto-start-reverse"
          >
            <path d="M 0 0 L 10 5 L 0 10 z" fill="currentColor" />
          </marker>
        </defs>

        <!-- *ngFor="let connection of connections" -->
        @for (connection of connections; track $index) {
        <g>
          <path
            [style]="getConnectionPathStyle(connection.gradient)"
            [attr.d]="connection.path"
            stroke="url(#line-gradient-template)"
            marker-end="url(#arrowhead)"
            fill="none"
          ></path>
        </g>
        }
      </svg>
    </div>
  </div>
</div>
